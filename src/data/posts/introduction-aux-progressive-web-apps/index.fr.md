---
lang: fr
key: blog-post
image: /img/introduction_aux_progressive_web_app.png
imageAlt: Introduction aux Progressive Web Apps
path: introduction-progressive-web-apps-avantages-exemple-tuto
title: 'Introduction aux Progressive Web Apps : Avantages et d√©veloppement  '
description: >-
  Pourquoi les Progressive Web Apps sont-elles devenues l‚Äôun des √©l√©ments-cl√©s
  de la strat√©gie commerciale de Google ? D√©couvrez les avantages d‚Äôune
  progressive web app et un tuto appliqu√© √† un exemple concret pour d√©velopper
  votre PWA. 
date: 2020-01-06T17:03:48.051Z
tags:
  - ccm
authors:
  - avatar: /img/mag.jpg
    firstname: Mathieu
    lastname: Gauthier
introduction: >-
  Les Progressive Web Apps sont une invention de Google. Initialement, elles
  √©taient destin√©es aux pays √©mergents, grands consommateurs d‚ÄôInternet mais o√π
  les smartphones utilis√©s sont loin d‚Äô√™tre aussi performants que ceux que nous
  connaissons. Leur m√©moire est tr√®s limit√©e, la couverture r√©seau en est encore
  √† la 2G/3G et le co√ªt de la data est √©lev√©. Difficile alors d‚Äôinstaller des
  applications natives gourmandes en stockage et n√©cessitant une connexion
  Internet pour leur bon fonctionnement. C‚Äôest pourquoi, pour faciliter son
  implantation dans ces pays en voie de d√©veloppement, Google n‚Äôavait d‚Äôautres
  choix que d‚Äôopter pour une nouvelle solution technologique afin de s‚Äôadapter
  au march√©. La multinationale prend alors la d√©cision d'investir dans le
  d√©veloppement d'applications web l√©g√®res, rapides, installables et
  ind√©pendantes de la qualit√© du r√©seau : la Progressive Web App (PWA).
  Regardons de plus pr√®s les avantages de ce type d‚Äôapplication mobile et leurs
  principes de d√©veloppement.
---
## 01/ Les Progressive Web Apps : une alternative aux applications natives √† consid√©rer

### Les avantages de la PWA vs. l'application native

A priori, la strat√©gie de Google se base uniquement sur la proposition d'une nouvelle offre dans les pays √©mergents. Mais quel serait l'int√©r√™t d'une PWA dans un pays fortement industrialis√© ? Les capacit√©s des smartphones en Europe sont bien assez suffisantes pour installer de nombreuses applications natives. Alors pourquoi songer √† privil√©gier le d√©veloppement d'une PWA au lieu d'une application native.

Plusieurs r√©ponses sont valables :

* **La distribution des applications natives est compliqu√©e.** Pour qu'un de vos clients utilise votre application, il faut le convaincre d'aller la t√©l√©charger depuis un store ou votre site web, puis de l'installer (autrement-dit prendre une partie plus ou moins volumineuse de la capacit√© de stockage de son smartphone) et enfin, de l'inciter √† l'utiliser et √† y revenir. Cela demande beaucoup d'efforts, et un co√ªt d'acquisition qui, [selon la startup portugaise Selio](https://www.geekmj.org/progressive-web-app-introduction), serait 10 fois plus √©lev√© que pour une PWA.
* **Le c√¥ut de production d'une PWA est tr√®s faible.** Au lieu de mobiliser plusieurs √©quipes de d√©veloppeurs pour la r√©alisation d'une application native iOS, Android ou d'un site web, le d√©veloppement d'une Progressive Web App ne n√©cessite qu'une seule √©quipe.
* **La PWA am√©liore l'engagement des utilisateurs.** De nombreuses entreprises ont d√©cid√© de cr√©er ou de migrer vers des PWA pour am√©liorer leur taux d'engagement. On peut citer Twitter avec sa PWA [Twitter Lite](https://mobile.twitter.com/home), Uber, Trivago, New York Times et √©videmment, Google avec Maps Go, Photos, Google +... Vous pouvez retrouver sur le site [PwaStats](https://www.pwastats.com/) les statistiques commerciales des PWA de certaines de ces entreprises et bien d'autres.
* **La PWA peut rivaliser avec une application native.** En fonction de vos besoins, il est possible d'obtenir des r√©sultats tr√®s satisfaisants en mati√®re de performance. Nicolas Gallagher, Engineer Lead de Twitter Lite confie :

> Twitter Lite is now the fastest, least expensive, and most reliable way to use Twitter. The web apprivals the performance of our native apps but requires less than 3% of the device storage space compared to Twitter for Android.

D'un point de vue fonctionnel, les PWA arrivent √©galement aujourd'hui √† utiliser des fonctionnalit√©s propres aux applications natives gr√¢ce aux HTML5 APIs.

* **Faible consommation de donn√©es.** Une application native peut consommer plusieurs dizaines de MB voire GB de data (par exemple, il n'est pas rare d'obtenir un cache de plusieurs GB pour l'application mobile Facebook). Pour une PWA, le serveur distribue uniquement des fichiers HTML, CSS et Javascript compress√©s et minifi√©s de mani√®re √† r√©duire consid√©rablement la taille de l'application mais aussi du cache. Dans le cas de Twitter, la Progressive Web App ne fait que 600KB contre 23.5MB pour l'application Android.

### Progressive Web Apps sur iOS : Apple tente de r√©sister

Il est ind√©niable que la PWA √† son niveau actuel ne remplace pas l'application mobile telle qu'on la conna√Æt. Cela est d√ª √† son manque de fonctionnalit√©s natives support√©es par l'OS de nos smartphones et plus particuli√®rement par iOS. De plus, l'√©volutivit√© du march√© de la PWA chez Apple parait compromise en raison d'un manque √† gagner sur la *"App StoreTax"* de 30%. En effet, cette taxe √©tant applicable uniquement aux applications sur l‚ÄôApp Store et donc aux applications natives, la PWA s‚Äôen est affranchie.

Pour autant, en Mars 2019, Apple a fait un effort avec la sortie de iOS 11.3 et Safari 13. Un utilisateur d'iPhone peut dor√©navant supporter une partie des fonctionnalit√©s des Progressive Web Apps.

En effet, difficile de compl√®tement fermer la porte aux Progressive Web Apps, √† pr√©sent largement adopt√©es par les entreprises et les particuliers. En addition des avantages √©voqu√©s plus haut, elles repr√©sentent notamment un atout majeur pour vos communications client, capable de nettement am√©liorer l'engagement de vos utilisateurs qu‚Äôils soient adeptes de Safari, Internet Explorer, ou bien Chrome √©videmment.

## 02 / Les Progressive Web Apps pour vos communications commerciales

![Progressive Web Apps](/img/pwa_bg.jpg "PWA Tessi")

Chez [Tessi](https://www.tessi.eu/solution/technologies/consulting-and-integration/), nous proposons des solutions de traitement et gestion documentaire permettant de composer, de produire et de d√©livrer des mod√®les de document (maquettes) en volume et/ou personnalis√©es en fonction du besoin. Certains de ces logiciels int√®grent des modules de composition de documents dynamiques. En d'autres termes, il s'agit de g√©n√©rer, √† partir d'un ou plusieurs flux de donn√©es, une collection d'applications rendues uniquement c√¥t√© client. L'outil utilise un *framework* de cr√©ation d'interface utilisateur, bas√© sur une architecture de composants : [Bobril](https://github.com/Bobris/Bobril). Cela permet d'utiliser le logiciel simplement en int√©grant des blocs (tableau, image, diagrammes, contenu textuel...) dans une interface de conception.

Un document dynamique est g√©n√©r√© sous la forme d'un seul fichier HTML, encapsulant Javascript, CSS et images (encod√©es en base 64). Contrairement √† un document statique (PDF par exemple), la livraison d'un fichier HTML ne peut se faire via mail ou un t√©l√©chargement sur un site. L'exp√©rience client ne serait pas au rendez-vous.

Cependant, il peut √™tre particuli√®rement int√©ressant d‚Äôutiliser les fonctionnalit√©s d‚Äôune PWA pour d√©livrer ce type de document. Il est tout √† fait imaginable de d√©velopper un tableau de bord regroupant l'ensemble des documents dynamiques d'un utilisateur, les rendant accessibles et s√©curis√©s via un portail web. Au moment de la premi√®re consultation d'un document, le client peut alors l'ajouter comme une application native sur son √©cran d'accueil, gr√¢ce √† une banni√®re, et profiter des capacit√©s offline de son document. Un syst√®me de push notifications peut √©galement √™tre int√©gr√© pour informer l'utilisateur d'une nouvelle livraison. La fluidit√© de ce processus permet d'am√©liorer, aupr√®s du client, l'exp√©rience utilisateur et par cons√©quent son engagement.

## 03 / Tutoriel : comment d√©velopper une Progressive Web App ?

### Le cahier des charges pour une PWA

Une PWA est r√©ussie lorsqu‚Äôelle respecte les principes F.I.R.E (fiable, int√©gr√©e, rapide, et engageante). On vous partage quelques bonnes pratiques pour y parvenir :

* **FAST** 

  Vous pouvez rendre votre PWA **performante** en int√©grant un [App-Shell](https://developers.google.com/web/fundamentals/architecture/app-shell) √† vos pages, en r√©duisant la taille de vos fichiers, en optimisant et compressant les images, en suivant le pattern [PRPL](https://developers.google.com/web/fundamentals/performance/prpl-pattern/)... L'objectif est que l'application ne charge qu‚Äôune faible quantit√© de donn√©es c√¥t√© serveur et que son utilisation reste fluide malgr√© les animations ou les utilisations d'API HTML5.
* **INTEGRATED**

  Une progressive web app est dite **int√©gr√©e** lorsque les navigateurs sont capables de trouver rapidement votre web app et de la proposer en tant qu‚Äôapplication installable sur l‚Äô√©cran d‚Äôaccueil sans passer par un app store. Cela est rendu possible gr√¢ce aux manifestes W3C et √† l'installation du Service Worker (gestionnaire de cache).
* **RELIABLE**

  Pour qu'une Progressive Web App soit consid√©r√©e comme **fiable**, il faut √©viter √† tout prix de se heurter au probl√®me du lie-fi. C‚Äôest ce moment o√π le r√©seau indique sur votre smartphone une connexion stable alors que ce n'est pas le cas. Parer √† ce d√©sagr√©ment n√©cessite d‚Äôutiliser un Service Worker correctement configur√© pour manipuler les fichiers (HTML, CSS, JS, images...). De plus, il faut que votre application soit servie via HTTPS pour √©viter les fraudes lors des transactions client-serveur par formulaire.
* **ENGAGING**

  Votre PWA sera **engageante** si elle est responsive, c‚Äôest-√†-dire qu'elle s‚Äôadapte √† n‚Äôimporte quel format : mobile, tablette, desktop. Il est √©galement conseill√© de mettre votre contenu r√©guli√®rement √† jour et envoyer des notifications push pour inviter les utilisateurs √† revenir. Enfin, il est possible de limiter les demandes d‚Äôacc√®s √† des fonctionnalit√©s de votre smartphone √† certaines pages seulement. Par exemple, Google Maps ne vous demande pas, d√®s l'ouverture de celle-ci, les autorisations d‚Äôacc√®s dont elle a besoin pour pleinement fonctionner (ce que font les applications natives). En l‚Äôoccurrence, Google maps peut avoir besoin d‚Äôactiver la fonctionnalit√© de g√©olocalisation de votre smartphone. Mais elle ne vous demandera cette autorisation que lorsque vous aurez besoin d‚Äôun itin√©raire depuis votre position. L'utilisateur comprend alors l‚Äôobjet de la demande. Cette derni√®re √©tant contextualis√©e, elle semble moins intrusive. Ainsi, l‚Äôutilisateur est plus √† m√™me d'accepter.

L'ensemble de ces fonctionnalit√©s forment un cahier des charges pr√©cis. A cet effet, vous pouvez utiliser l'outil Google Lighthouse qui permet de v√©rifier cette checklist √† votre place. Sur Chrome, vous pouvez effectuer cet audit depuis la console de votre navigateur. Celui-ci vous donnera une note entre 0 et 100 en fonction des performances, des bonnes pratiques, de l'accessibilit√© et du r√©f√©rencement (SEO) de votre application.

### Les principes de d√©veloppement d'une PWA

Le d√©veloppement d'une Progressive Web App ne n√©cessite aucun framework particulier. Vous pouvez d√©velopper votre application enti√®rement en utilisant du HTML, CSS et du Javascript (JS) mais il est pr√©f√©rable, dans un objectif de mise en production, d'utiliser des outils performants et flexibles. Cela vous permettra de vous concentrer sur la partie m√©tier de votre application et de gagner du temps sur la configuration d'une PWA.

Pour le d√©veloppement, il convient bien s√ªr de garder en t√™te les principes F.I.R.E. Toutefois, nous nous concentrerons surtout sur les aspects d‚Äôint√©gration et de fiabilit√© pour la suite de l'article. Les autres points sont √©galement essentiels mais d√©pendants du contenu et des fonctionnalit√©s de votre application.

#### Service Worker

Dans le cahier des charges, le Service Worker est un des √©l√©ments indispensables pour valider votre PWA. Il s'agit d'un script lanc√© en t√¢che de fond non bloquante servant de *proxy* pour servir les fichiers de votre application. Le Service Worker est enregistr√© par le navigateur et r√©pond √† des √©v√©nements de mani√®re asynchrone pour mettre en cache vos fichiers HTML, CSS, JS, images etc...

Lors de la seconde visite de l'utilisateur, le Service Worker d√©tecte si une mise √† jour des fichiers est n√©cessaire. Si ce n'est pas le cas, il va rediriger les requ√™tes faites par le client vers les fichiers en cache. Cela vous permet donc de garder votre application compl√®tement hors-ligne.

Si du nouveau contenu est arriv√© du c√¥t√© de votre serveur web, le Service Worker est capable de mettre √† jour les fichiers en cache, une fois la connexion de votre utilisateur de nouveau disponible.

Pour permettre √† votre navigateur d'enregistrer votre Service Worker, il vous suffit d'ajouter la balise `<script>` ci-dessous √† votre fichier HTML (avant la balise fermante `</body>`).

```html:title=index.html
<html>
  <head>
    <!-- [...] -->
  </head>
  <body>
    <!-- Contenu de votre application/votre App Shell-->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker
            .register('/sw.js')
            .then(registration => {
              console.log(
                `Service Worker enregistr√© ! Ressource: ${registration.scope}`
              );
            })
            .catch(err => {
              console.log(
                `Echec de l'enregistrement du Service Worker: ${err}`
              );
            });
        });
      }
    </script>
  </body>
</html>
```

Dans le code ci-dessus, on utilise directement l'API native `navigator` et on v√©rifie [la compatibilit√© PWA avec le navigateur](https://caniuse.com/#search=service%20worker). Si la comptabilit√© est v√©rifi√©e, on utilise en Javascript les [Promises](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise) pour r√©aliser des op√©rations asynchrones. On tente alors d'enregistrer un Service Worker (SW). Si cette op√©ration est un succ√®s, on r√©alise la fonction ins√©r√©e en tant que param√®tre dans le `then`. Ici, il s'agit d'un simple `console.log(message)`. Si, au contraire, l'enregistrement du SW √©choue, l'exception est r√©cup√©r√©e dans le `catch`.

Le fichier `sw.js` n'est pas encore pr√©sent sur le serveur. On va l'ajouter et l'agr√©menter de quelques lignes de Javascript indispensables pour g√©rer correctement la capacit√© *offline* de votre PWA. Nous allons utiliser ici un outil, d√©velopp√© par l'√©quipe Google Chrome, pour param√©trer notre SW: [Workbox](https://developers.google.com/web/tools/workbox/).

```javascript:title=sw.js
importScripts(
  'https://storage.googleapis.com/workbox-cdn/releases/4.3.1/workbox-sw.js'
);
if (workbox) {
  console.log(`Super ! Workbox est charg√© üéâ`);
  
  workbox.routing.registerRoute(
    /\.(?:html|js|css|png|jpg|jpeg|svg|gif)$/,
    new workbox.strategies.StaleWhileRevalidate()
  );
}
```

Ce petit script permet de servir tous les fichiers HTML, CSS, JS et images depuis le cache du navigateur. De plus, le Service Worker met √† jour toutes ces ressources si besoin, √† partir du r√©seau, en fond de t√¢che. On peut √©videmment modifier l'expression r√©guli√®re utilis√©e ici pour capturer d'autres types de fichier comme de la vid√©o ou de l'audio.

La gestion du cache n'est pas chose ais√©e. Elle d√©pend des ressources, de l'utilisation et du d√©veloppement de votre application. Dans notre cas, Workbox effectue √©norm√©ment de travail qui nous √©pargne l'utilisation de l'API [Cache](https://developer.mozilla.org/en-US/docs/Web/API/Cache). L'outil nous permet d'appliquer plusieurs [strat√©gies](https://developers.google.com/web/tools/workbox/reference-docs/latest/workbox.strategies) en fonction des ressources √† r√©cup√©rer sur le serveur. Dans notre exemple, la strat√©gie `StaleWhileRevalidate` demande au Service Worker de r√©cup√©rer les ressources depuis le cache et le r√©seau en parall√®le. Si une ancienne version de ces ressources est d√©j√† en cache, la strat√©gie va alors proposer de la servir au client. En parall√®le, des requ√™tes HTTP essayent de r√©cup√©rer une nouvelle version sur le serveur. Le cache est alors mis √† jour avec la r√©ponse du r√©seau pour chaque requ√™te r√©ussie.

Avec cette politique de cache et notre SW enregistr√©, nous rendons notre application beaucoup plus fiable et moins d√©pendante du r√©seau. Passons maintenant √† l'int√©gration de notre future PWA...

#### Web App Manifest

La prochaine √©tape de d√©veloppement c'est la mise en place d'un manifeste [W3C](https://w3c.github.io/manifest/) propre √† la PWA. Il s'agit d'un fichier *JSON* dans lequel on retrouve les informations de l'application comme son nom, ses ic√¥nes, l'affichage en tant qu'application native etc... Ce manifeste autorise l'application √† la lanc√©e en mode plein √©cran (sans la barre d'adresse du navigateur `standalone`), g√©rer l'orientation de l'√©cran (forcer le lancement de l'application en mode `portrait`) et d√©finir un Splash Screen (avec un logo, un nom et une couleur de fond). Dans le fichier JSON ci-dessous, on d√©finit des ic√¥nes avec plusieurs tailles. L'image en *192x192px* sera utilis√©e en tant qu'ic√¥ne de lancement sur l'√©cran d'accueil de votre smartphone. Quant √† celle en *512x512px*, elle sera affich√©e sur le Splash Screen.

```json:title=manifest.json
{
  "name": "My App",
  "short_name": "My App",
  "description": "My App description",
  "start_url": "/",
  "display": "standalone",
  "orientation": "portrait",
  "theme_color": "#3f51b5",
  "background_color": "#3f51b5",
  "icons": [
    {
      "src": "images/manifest/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "images/manifest/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

Il ne nous reste plus qu'√† cr√©er le lien dans le fichier HTML avec ce manifeste.

Mais avant, un dernier obstacle doit √™tre √©cart√© !

Le tableau JSON `icons` du manifeste est un standard qui n'est pas pris en compte par Safari (sur iOS, m√™me avec les derni√®res versions). Il faut ajouter un lien `apple-touch-icon` dans votre HTML pour cr√©er votre ic√¥ne de lancement sur iOS.

```html:title=index.html
<html>
  <head>
    <!-- [...] -->
    <link rel="manifest" href="./manifest.json" />
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="./images/manifest/icon-180x180.png"
    />
  </head>
  <body>
    <!-- Contenu de votre application/votre App Shell-->
    <script>
      // Script d'enregistrement du SW, vu pr√©c√©demment
    </script>
  </body>
</html>
```

Dor√©navant, votre application peut s'installer sur votre √©cran d'accueil de smartphone. Mais comment votre utilisateur peut-il savoir si votre site est int√©grable ?

Google Chrome (et maintenant Firefox) sur Android, affiche automatiquement une banni√®re sur votre site pour indiquer qu'il peut √™tre int√©gr√© comme une application native. Toutefois, votre site doit respecter les points suivants :

* Avoir un manifest W3C valide
* L'ensemble de ces ressources doivent √™tre servies sur du HTTPS ([](https://letsencrypt.org/)[Certigna](https://www.certigna.com/), tiers de confiance europ√©en du groupe Tessi, proprose des certificats hautement s√©curis√©s, certifi√©s RGS/eIDAS).
* Avoir un Service Worker valide et enregistr√©
* √ätre visit√© deux fois, avec au moins 5 minutes entre chaque visite

Une autre solution serait de proposer votre propre banni√®re avec les explications d'installation sur [Chrome](https://support.google.com/pixelphone/answer/2781850?hl=en), [Firefox](https://hacks.mozilla.org/2017/10/progressive-web-apps-firefox-android/) ou [Safari](https://support.apple.com/fr-fr/guide/shortcuts/apd735880972/ios). Libre √† vous de d√©cider !

***En conclusion, la PWA est une alternative aux applications natives qui peut se r√©v√©ler √™tre une excellente opportunit√©. Elle dispose d'atouts ind√©niables dont une facilit√©e de d√©veloppement et permet dans de nombreux cas d'utilisation l'am√©lioration de l'exp√©rience utilisateur. C'est pourquoi la PWA a gagn√© en popularit√© dans les entreprises sp√©cialis√©es dans le d√©veloppement logiciel. Il est de plus en plus commun de remplacer ses applications natives avec leur version PWA pour gagner en espace de stockage et ainsi laisser la place √† des applications plus importantes et plus volumineuses.***
